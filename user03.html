<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ‘ãƒ‘ã®éƒ¨å±‹</title>
  <script src="js/jquery-2.1.3.min.js"></script>
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/style_03.css">
	
</head>

<body>
	<header>
  <h1>ãƒ‘ãƒ‘ã®éƒ¨å±‹</h1>
</header>
		<!-- BGMã‚’æµã™ -->
		<section>
			<audio src="img/ed.mp3" id="audio" pause="pause" loop="loop"></audio>
			<div id="btn-gold">BGMã‚’å†ç”Ÿï¼åœæ­¢</div>
		</section>

		<div class="linkbtn">
		<button class="top" onclick="window.open('./index.html')">TOPã¸</button>
		<button class="kanon" onclick="window.open('./user01.html')">ã‚«ãƒãƒ³ã®éƒ¨å±‹ã¸</button>
		<button class="mama" onclick="window.open('./user02.html')">ãƒãƒã®éƒ¨å±‹ã¸</button>
		</div>
		
  <main>
		<div class="input-area">
		<div>
			<input id="uname" type="text" placeholder="åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
	</div>
      <textarea id="title" type="text" placeholder="ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ä»Šæ—¥ã®è³ªå•ã‚’é¸ã¼ã†ï¼"></textarea>
			<button class="btn btn-solid-silver" onClick="ranAry()">ä»Šæ—¥ã®è³ªå•</button>
      <textarea id="text" placeholder="ç­”ãˆã‚’æ•™ãˆã¦ã­ï¼"></textarea>
    </div>

			<button id="save"><span>é€ä¿¡</span></button>
  
		</main>

  <ul id="output">
    <!-- ã“ã“ã«è¿½åŠ ãƒ‡ãƒ¼ã‚¿ãŒæŒ¿å…¥ã•ã‚Œã‚‹ -->
  </ul>



  <!-- ä»¥ä¸‹ã«jsã‚’æ›¸ã„ã¦ã„ãã¾ã™ -->

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script type="module">
			// Import the functions you need from the SDKs you need
			import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
			import { getDatabase, ref, push, set, update, onChildAdded, remove, onChildRemoved , onChildChanged}
					from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
			// Your web app's Firebase configuration
			const firebaseConfig = {
  apiKey: "AIzaSyCRoZ90FAEvm0ouGFVUqrb7-p2bj8Ikh-Y",
  authDomain: "gsdev26us07-f16a4.firebaseapp.com",
  databaseURL: "https://gsdev26us07-f16a4-default-rtdb.firebaseio.com",
  projectId: "gsdev26us07-f16a4",
  storageBucket: "gsdev26us07-f16a4.appspot.com",
  messagingSenderId: "499292069688",
  appId: "1:499292069688:web:bebadcdb08d4b36d4aebcd"
};
		
			const app = initializeApp(firebaseConfig);
			const db = getDatabase(app); //RealtimeDBã«æ¥ç¶š
			const dbRef = ref(db, "chat03"); //RealtimeDBå†…ã®"chat"ã‚’ä½¿ã†



    //1.Save ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ(ãƒ‡ãƒ¼ã‚¿ç™»éŒ²)

$("#save").on("click", function(){
	const uname = $("#uname").val();
	const title = $("#title").val();
	const text = $("#text").val();

	console.log(uname,'unameã®æ–‡å­—')
	console.log(title,'titleã®æ–‡å­—')
	console.log(text,'textã®æ–‡å­—')

// å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—ãŒç¢ºèªã§ããŸã‚ã¨ã¯
// firebaseã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã¾ã™

const msg = {
	uname: uname,
	title: title,
	text: text
}

// firebaseã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹å‡¦ç†
// pushã¯firebaseãŒç”¨æ„ã—ãŸãŠã¾ã˜ãªã„ï¼ˆæ³¨æ„ï¼‰
const newPostRef = push(dbRef);
// setã¯firebaseãŒç”¨æ„ã—ãŸãŠã¾ã˜ãªã„ï¼ˆæ³¨æ„ï¼‰
set(newPostRef, msg);

// é€ä¿¡ã‚’æŠ¼ã—ãŸã‚‰å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—ã‚’æ¶ˆã™ã«ã¯ï¼Ÿ
	$('#uname').val("");
	$('#title').val("");
	$('#text').val("");

// ã“ã®ä¸‹ã¯æ¶ˆã•ãªã„
})

   //ãƒ‡ãƒ¼ã‚¿ç™»éŒ²(Enter)

  //æœ€åˆã«ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼†onSnapshotã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
		onChildAdded(dbRef, function (data) {

		const msg = data.val();
		const key = data.key; //å‰Šé™¤ãƒ»æ›´æ–°ã«å¿…é ˆ

		console.log(data,'å¡Š')
		console.log(msg,'å¡Š')
		console.log(key,'éµ')

					// let h = '<p id="'+key+'">';
					// 		h += msg.uname;
					// 		h += '<br>';
					// 		h += msg.title;
					// 		h += '<br>';
					// 		h += '<span contentEditable="true" id="'+key+'_update">'+msg.text+'</span>';
					// 		h += '<span class="remove" data-key="'+key+'"> ğŸš®</span>'
					// 		h += '<span class="update" data-key="'+key+'"> ğŸ†™</span>'
					// 		h += '</p>';
					
					let h = '<div id="'+key+'">';
							h += '<p class="puname">';
							h += msg.uname;
							h += '</p>';
							h += '<p class="ptitle">';
							h += msg.title;
							h += '</p>';
							h += '<p class="ptext">';
							h += '<span contentEditable="true" id="'+key+'_update">'+msg.text+'</span>';
							h += '</p>';
							h += '<span class="remove" data-key="'+key+'"> ğŸš®</span>'
							h += '<span class="update" data-key="'+key+'"> ğŸ†™</span>'
							h += '</div>';

					$('#output').prepend(h);

				});

				// å‰Šé™¤ã‚¤ãƒ™ãƒ³ãƒˆ
				$("#output").on("click", ".remove", function(){
					const key = $(this).attr("data-key");
					const remove_item = ref(db,"chat02/"+key);
					remove(remove_item); //firebaseãƒ‡ãƒ¼ã‚¿å‰Šé™¤é–¢æ•°
				});

				// æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆ
				$("#output").on("click", ".update", function(){
					const key = $(this).attr("data-key");
					update(ref(db, "chat02/"+key), {
						text: $("#"+key+'_update').html()
					}); //firebaseãƒ‡ãƒ¼ã‚¿å‰Šé™¤é–¢æ•°
				});

				// å‰Šé™¤å‡¦ç†ãŒfirebaseå´ã§å®Ÿè¡Œã•ã‚ŒãŸã‚‰ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿï¼
				onChildRemoved(dbRef, (data) => {
					$("#"+data.key).remove(); //DOMæ“ä½œé–¢æ•°ï¼ˆå¯¾è±¡ã‚’å‰Šé™¤ï¼‰
				});

				// æ›´æ–°å‡¦ç†ãŒfirebaseå´ã§å®Ÿè¡Œã•ã‚ŒãŸã‚‰ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿï¼
				onChildChanged(dbRef, (data) => {
					$("#"+data.key+'_update').html(data.val().text);
					$("#"+data.key+'_update').fadeOut(800).fadeIn(800);
				});

</script>
				<script type="text/javascript">

function ranAry() {
	let q = ["Q.ä¸€ç•ªå¥½ããªé£Ÿã¹ç‰©ã¯ï¼Ÿ","Q.å­ä¾›ã®é ƒã®ã‚ã åã¯ï¼Ÿ","Q.ã©ã‚“ãªæ™‚ã«æ¥½ã—ã„ã¨æ„Ÿã˜ã‚‹ï¼Ÿ","Q.è‡ªåˆ†ã‚’æ¼¢å­—ä¸€æ–‡å­—ã§è¡¨ã™ã¨ï¼Ÿ","Q.ä»Šæ—¥ä¸€ç•ªå¬‰ã—ã‹ã£ãŸã“ã¨ã¯ï¼Ÿ","Q.ä»Šæ—¥ä¸€ç•ªè…¹ãŒç«‹ã£ãŸã“ã¨ã¯ï¼Ÿ","Q.ä»Šæ—¥ä¸€ç•ªç¬‘ã£ãŸã“ã¨ã¯ï¼Ÿ","Q.ä»Šæ—¥ã®å‡ºæ¥äº‹ã‚’3ã¤æ•™ãˆã¦ï¼","Q.è‡ªåˆ†ã®å£ç™–ã¯ï¼Ÿ","Q.è‡ªåˆ†ã£ã¦ã©ã‚“ãªæ€§æ ¼ï¼Ÿ","Q.æœ€è¿‘ã®ãƒã‚¤ãƒ–ãƒ¼ãƒ ã¯ï¼Ÿ","Q.æœ€è¿‘ä¸€ç•ªæ¥½ã—ã‹ã£ãŸã“ã¨ã¯ï¼Ÿ","Q.æœ€è¿‘ä¸€ç•ªé¢ç™½ã‹ã£ãŸã“ã¨ã¯ï¼Ÿ","Q.æœ€è¿‘ä¸€ç•ªæ‚²ã—ã‹ã£ãŸã“ã¨ã¯ï¼Ÿ","Q.æœ€è¿‘ä¸€ç•ªãƒ ã‚«ã¤ã„ãŸã“ã¨ã¯ï¼Ÿ","Q.æ˜æ—¥ã‚„ã‚ŠãŸã„ã“ã¨ã¯ï¼Ÿ","Q.ä»Šæ—¥ä¸­ã«ã‚„ã‚ŠãŸã„ã“ã¨ã¯ï¼Ÿ","Q.æœ€è¿‘è¦‹ãŸå¤¢ã‚’æ•™ãˆã¦ï¼","Q.ä»Šã®æœ¬éŸ³ã‚’ã‚ºãƒãƒªæ•™ãˆã¦ï¼","Q.ã©ã‚“ãªè¨€è‘‰ãŒå¥½ãï¼Ÿ","Q.è¨€ã‚ã‚Œã¦å«Œãªæ°—æŒã¡ã«ãªã‚‹è¨€è‘‰ã¯ï¼Ÿ","Q.10å¹´å¾Œã®è‡ªåˆ†ã£ã¦ã©ã‚“ãªã‚¤ãƒ¡ãƒ¼ã‚¸ï¼Ÿ","Q.å®¶æ—ã«ã²ã¨ã“ã¨ï¼","Q.è‡ªåˆ†ã«ã²ã¨ã“ã¨ï¼","Q.ä½•è€ƒãˆã¦ã‚‹ã“ã¨ãŒå¤šã„ï¼Ÿ","Q.ã©ã‚“ãªäººã¨ã„ã‚‹ã¨æ¥½ï¼Ÿ","Q.ä¸€ç·’ã«ã„ãŸã„äººã£ã¦ã©ã‚“ãªäººï¼Ÿ","Q.å¯ã‚‹æ™‚ã©ã‚“ãªã“ã¨è€ƒãˆã¦ã‚‹ï¼Ÿ","Q.å­ä¾›ã®é ƒå¾—æ„ã ã£ãŸã“ã¨ã¯ä½•ï¼Ÿ","Q.ã©ã®æ•™ç§‘ãŒå¾—æ„ã ã£ãŸï¼Ÿ","Q.ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã¯ï¼Ÿ","Q.äººã‹ã‚‰ã©ã®ã‚ˆã†ã«è¤’ã‚ã‚‰ã‚Œã‚‹ï¼Ÿ","Q.è¶£å‘³ã¯ä½•ï¼Ÿ","Q.å®¶æ—ã¯ã‚ãªãŸã®ã©ã‚“ãªã¨ã“ã‚ãŒå¥½ãã ã¨æ€ã†ï¼Ÿ","Q.é•·å¹´ç¶šã‘ã¦ã„ã‚‹ã“ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ","Q.å‘¨ã‚Šã«ã¯ã©ã®ã‚ˆã†ãªäººãŸã¡ãŒã„ã¾ã™ã‹ï¼Ÿ","Q.å›°ã£ãŸæ™‚ã«ç›¸è«‡ã«ä¹—ã£ã¦ãã‚Œã‚‹äººã¯ä½•äººã„ã¾ã™ã‹ï¼Ÿ","Q.ä½•ã‹é”æˆã—ãŸæ™‚ã«å–œã‚“ã§ãã‚Œã‚‹äººãŸã¡ã¯èª°ã§ã™ã‹ï¼Ÿ","Q.5å¹´å¾Œã®è‡ªåˆ†ã«ã²ã¨ã“ã¨ï¼","Q.1é€±é–“å¾Œã®è‡ªåˆ†ã‚’è¤’ã‚ã‚‹ã¨ã—ãŸã‚‰ä½•ã‚’è¤’ã‚ã‚‹ï¼Ÿ","Q.1ãƒ¶æœˆå¾Œã«ä¸–ç•ŒãŒæ»…ã¶ã¨ã—ãŸã‚‰ä½•ã‚’ã™ã‚‹ï¼Ÿ","Q.ä»Š1000ä¸‡å††æ‰‹ã«å…¥ã£ãŸã‚‰ä½•ã«ä½¿ã†ï¼Ÿ","Q.å‹é”ã‹ã‚‰è¦‹ãŸè‡ªåˆ†ã®å°è±¡ã¯ï¼Ÿ"];

  document.getElementById("title").value = q[Math.floor(Math.random() * q.length)];
}

	// éŸ³æ¥½ã‚’æµã™
	$(function() {
		var audio = $("#audio").get(0);
		var isPlaying = false;
		$("#btn-gold").on("click", function () {
			if (isPlaying) {
				audio.pause();
			} else {
				audio.play();
			}
		});
		audio.onplaying = function() {
			isPlaying = true;
		};
		audio.onpause = function() {
			isPlaying = false;
		};
	});

</script>

				<!-- jQueryã®jsã‚³ãƒ¼ãƒ‰ã‚’å…ˆã«èª­ã¿è¾¼ã‚€ï¼ -->
				<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

				<!-- jsã‚’ç´ã¥ã‘ã‚‹ã€‚ä¸‹ã«æ›¸ã‹ãªã„ã¨UXã«æ‚ªã„ -->
				<!-- <script src="js/user02.js"></script> -->
</body>

</html>
